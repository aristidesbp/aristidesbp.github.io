-- Criar a tabela de entidades
CREATE TABLE IF NOT EXISTS entidades (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL,
    usuario_id UUID REFERENCES auth.users(id), -- Vincula ao usuário que criou
    
    -- Informações e Acesso
    nome_completo TEXT NOT NULL,
    cpf TEXT,
    data_nascimento DATE,
    email TEXT,
    telefone TEXT,
    senha_acesso TEXT,
    acesso TEXT DEFAULT 'cliente',
    relacionamento TEXT DEFAULT 'cliente',
    status TEXT DEFAULT 'ativo',
    avaliacao INTEGER DEFAULT 5,
    
    -- Endereço
    cep TEXT,
    logradouro TEXT,
    numero TEXT,
    bairro TEXT,
    cidade TEXT,
    estado TEXT,
    
    -- Complementos
    arquivos_url TEXT[] DEFAULT '{}', -- Array de strings para URLs
    observacoes TEXT
);

-- Ativar RLS (Row Level Security)
ALTER TABLE entidades ENABLE ROW LEVEL SECURITY;

-- Criar política: Usuários podem ver/editar apenas seus próprios dados cadastrados
-- (Ou ajuste conforme sua necessidade de compartilhamento)
CREATE POLICY "Permitir acesso total ao criador" ON entidades
    FOR ALL
    USING (auth.uid() = usuario_id);

-- Criar índice para busca rápida por nome
CREATE INDEX idx_entidades_nome ON entidades (nome_completo);
