<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minha Loja</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">

  <!-- Título da Loja -->
  <div class="max-w-5xl mx-auto text-center mb-6">
    <h1 class="text-3xl font-bold">Bem-vindo à Minha Loja</h1>
    <p class="text-gray-700">Compre seus produtos favoritos!</p>
  </div>

  <!-- Lista de Produtos -->
  <div id="produtosContainer" class="max-w-5xl mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>

  <!-- Carrinho -->
  <div class="max-w-5xl mx-auto mt-8 bg-white shadow rounded-xl p-4">
    <h2 class="text-2xl font-bold mb-3">Carrinho</h2>
    <ul id="carrinhoLista" class="space-y-2"></ul>
    <div class="mt-4 flex justify-between items-center">
      <span class="font-bold text-lg">Total: R$ <span id="totalCarrinho">0.00</span></span>
      <button id="limparCarrinho" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Limpar Carrinho</button>
    </div>
  </div>

  <script>
    class Produto {
      constructor({imagem, nome, descricao, valor, codigoBarras, fornecedor, validade}) {
        this.imagem = imagem || "";
        this.nome = nome;
        this.descricao = descricao;
        this.valor = parseFloat(valor).toFixed(2);
        this.codigoBarras = codigoBarras;
        this.fornecedor = fornecedor;
        this.validade = validade;
      }
    }

    class Loja {
      constructor() {
        this.produtos = JSON.parse(localStorage.getItem("produtos") || "[]").map(p => new Produto(p));
        this.carrinho = [];
        this.produtosContainer = document.getElementById("produtosContainer");
        this.carrinhoLista = document.getElementById("carrinhoLista");
        this.totalCarrinhoEl = document.getElementById("totalCarrinho");
        this.limparBtn = document.getElementById("limparCarrinho");
        this.renderProdutos();
        this.bindEventos();
      }

      renderProdutos() {
        this.produtosContainer.innerHTML = "";
        this.produtos.forEach((p, i) => {
          const card = document.createElement("div");
          card.className = "bg-white shadow rounded-xl p-4 flex flex-col";
          card.innerHTML = `
            <img src="${p.imagem}" alt="${p.nome}" class="w-full h-48 object-cover rounded mb-3" />
            <h3 class="font-bold text-lg">${p.nome}</h3>
            <p class="text-gray-700 text-sm mb-2">${p.descricao}</p>
            <p class="font-semibold mb-2">R$ ${p.valor}</p>
            <button data-index="${i}" class="adicionarCarrinho bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700">Adicionar ao Carrinho</button>
          `;
          this.produtosContainer.appendChild(card);
        });
      }

      renderCarrinho() {
        this.carrinhoLista.innerHTML = "";
        let total = 0;
        this.carrinho.forEach((item, idx) => {
          total += parseFloat(item.valor);
          const li = document.createElement("li");
          li.className = "flex justify-between items-center border rounded p-2 bg-gray-50";
          li.innerHTML = `
            <span>${item.nome} - R$ ${item.valor}</span>
            <button data-index="${idx}" class="removerCarrinho text-red-600 hover:underline text-sm">Remover</button>
          `;
          this.carrinhoLista.appendChild(li);
        });
        this.totalCarrinhoEl.textContent = total.toFixed(2);
      }

      adicionarAoCarrinho(index) {
        this.carrinho.push(this.produtos[index]);
        this.renderCarrinho();
      }

      removerDoCarrinho(index) {
        this.carrinho.splice(index,1);
        this.renderCarrinho();
      }

      limparCarrinho() {
        this.carrinho = [];
        this.renderCarrinho();
      }

      bindEventos() {
        this.produtosContainer.addEventListener("click", e => {
          if(e.target.classList.contains("adicionarCarrinho")){
            const idx = parseInt(e.target.dataset.index);
            this.adicionarAoCarrinho(idx);
          }
        });

        this.carrinhoLista.addEventListener("click", e => {
          if(e.target.classList.contains("removerCarrinho")){
            const idx = parseInt(e.target.dataset.index);
            this.removerDoCarrinho(idx);
          }
        });

        this.limparBtn.addEventListener("click", () => this.limparCarrinho());
      }
    }

    const loja = new Loja();
  </script>

</body>
</html>