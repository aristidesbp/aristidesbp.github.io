<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - ERP-ABP</title>

    <link rel="stylesheet" href="login/login.css">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script src="assets/config.js"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="login-card" id="login-container">
        <button id="btn-back" class="btn-back" onclick="toggleMode('login')" style="display: none;">
            ‚Üê Voltar para o Login
        </button>

        <header>
            <h1 class="brand-title">SISTEMA ERP ABP</h1>
            <p id="form-subtitle" class="text-muted">Fa√ßa login para acessar o ERP</p>
        </header>

        <form id="auth-form" onsubmit="event.preventDefault(); handleAuth();">
            <div class="input-container" id="email-group">
                <label for="email">E-mail</label>
                <input type="email" id="email" name="email" placeholder="exemplo@email.com" required>
            </div>

            <div class="input-container" id="pass-group">
                <label for="password">Senha</label>
                <div class="password-wrapper">
                    <input type="password" id="password" name="password" placeholder="Sua senha secreta" required>
                    <button type="button" class="toggle-password" onclick="toggleVisibility()" tabindex="-1">
                        <span id="eye-icon">üëÅÔ∏è</span>
                    </button>
                </div>
            </div>

            <button type="submit" class="main-btn" id="btn-auth">
                <span id="btn-text">Entrar</span>
                <div id="loader" class="loader-spinner" style="display: none;"></div>
            </button>
        </form>

        <div class="extra-links">
            <span id="link-forgot" class="link-action" onclick="toggleMode('recovery')">
                Esqueci minha senha
            </span>
        </div>

        <footer class="dev-info">
            <p>DESENVOLVEDOR: <strong>ARISTIDES BP</strong></p>
            <p>CONTATO: +55 91 99242-0981</p>
            
            <div class="language-selector">
                <select id="lang-select" onchange="changeLanguage(this.value)">
                    <option value="pt">Portugu√™s</option>
                    <option value="en">English</option>
                    <option value="es">Espa√±ol</option>
                </select>
            </div>
        </footer>
    </div>

    <script src="login/login.js"></script>
    <script>
        // L√≥gica de integra√ß√£o imediata com o dbsupabase do config.js
        async function handleAuth() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const btnText = document.getElementById('btn-text');
            const loader = document.getElementById('loader');
            const btnAuth = document.getElementById('btn-auth');

            // Estado de Loading (UI)
            btnText.style.display = 'none';
            loader.style.display = 'block';
            btnAuth.disabled = true;

            try {
                // USA O dbsupabase DEFINIDO NO config.js
                const { data, error } = await dbsupabase.auth.signInWithPassword({
                    email: email,
                    password: password,
                });

                if (error) throw error;

                // Sucesso: Toast e Redirecionamento
                console.log("Login realizado!", data);
                window.location.href = 'index.html';

            } catch (error) {
                alert("Erro na autentica√ß√£o: " + error.message);
                // Reset UI em caso de erro
                btnText.style.display = 'block';
                loader.style.display = 'none';
                btnAuth.disabled = false;
            }
        }

        function toggleVisibility() {
            const passInput = document.getElementById('password');
            const icon = document.getElementById('eye-icon');
            if (passInput.type === "password") {
                passInput.type = "text";
                icon.innerText = "üôà";
            } else {
                passInput.type = "password";
                icon.innerText = "üëÅÔ∏è";
            }
        }

        function toggleMode(mode) {
            const subtitle = document.getElementById('form-subtitle');
            const btnBack = document.getElementById('btn-back');
            const btnAuth = document.getElementById('btn-auth');
            const passGroup = document.getElementById('pass-group');

            if (mode === 'recovery') {
                subtitle.innerText = "Recuperar acesso ao sistema";
                btnBack.style.display = "block";
                btnAuth.innerText = "Enviar link de recupera√ß√£o";
                passGroup.style.display = "none";
            } else {
                subtitle.innerText = "Fa√ßa login para acessar o ERP";
                btnBack.style.display = "none";
                btnAuth.innerText = "Entrar";
                passGroup.style.display = "block";
            }
        }
    </script>
</body>
</html>
