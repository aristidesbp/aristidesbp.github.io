PAGINA SIMPLES COM O FORMULARIO E PAGAMENTO DO PDF SURPRESA
# CRIANDO UM METODO DE PAGAMENTO COM SUPABASE E MERCADO PAGO
## index.html
```
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprar E-book: Cria√ß√£o de PDF - Barraca do Ari</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #1e40af;
            --bg-page: #f8fafc;
        }
        body { background-color: var(--bg-page); font-family: sans-serif; }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .input-field { 
            width: 100%; padding: 12px; border: 1px solid #e2e8f0; 
            border-radius: 8px; outline: none; transition: border 0.3s;
        }
        .input-field:focus { border-color: var(--primary); ring: 2px solid #bfdbfe; }
        .btn-pay {
            background-color: var(--primary); color: white; width: 100%;
            padding: 16px; border-radius: 8px; font-weight: bold;
            transition: transform 0.2s, opacity 0.2s;
        }
        .btn-pay:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-pay:disabled { background-color: #94a3b8; cursor: not-allowed; }
        
        /* Skeleton de carregamento simples */
        .loading-spinner {
            border: 3px solid #f3f3f3; border-top: 3px solid var(--primary);
            border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite;
            display: inline-block; vertical-align: middle; margin-right: 8px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-slate-800">Barraca do Ari</h1>
            <p class="text-slate-500 uppercase tracking-widest text-sm font-semibold">Oferta Exclusiva</p>
        </header>

        <main class="card p-6 mb-6">
            <div class="flex flex-col md:flex-row gap-6 items-center mb-6">
                <img src="https://placehold.co/400x400?text=PDF+Expert" alt="Capa do PDF" class="w-32 h-32 rounded-lg object-cover shadow-sm">
                <div>
                    <h2 class="text-xl font-bold text-slate-800">E-book: Cria√ß√£o de PDF Profissional</h2>
                    <p class="text-slate-600 text-sm">Aprenda a criar documentos interativos e lucrativos do zero.</p>
                    <p class="text-blue-600 font-bold text-lg mt-2">R$ 2,00 <span class="text-xs text-slate-400 font-normal">/ unidade</span></p>
                </div>
            </div>

            <hr class="mb-6 border-slate-100">

            <div class="flex items-center justify-between bg-slate-50 p-4 rounded-xl mb-8">
                <span class="font-medium text-slate-700">Quantidade de licen√ßas:</span>
                <div class="flex items-center gap-4">
                    <button type="button" onclick="mudarQtd(-1)" class="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center font-bold text-xl">-</button>
                    <span id="qtdDisplay" class="text-xl font-bold min-w-[20px] text-center">1</span>
                    <button type="button" onclick="mudarQtd(1)" class="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center font-bold text-xl">+</button>
                </div>
            </div>

            <form id="payForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-1">Nome Completo</label>
                    <input type="text" id="cliente_nome" class="input-field" placeholder="Como quer ser chamado?" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-1">Seu melhor E-mail</label>
                    <input type="email" id="cliente_email" class="input-field" placeholder="Para onde enviamos o PDF?" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-1">WhatsApp</label>
                    <input type="tel" id="cliente_tel" class="input-field" placeholder="(91) 99999-9999" required>
                </div>

                <div class="pt-4">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-slate-500 font-medium">Total a pagar:</span>
                        <span class="text-2xl font-black text-slate-900">R$ <span id="totalDisplay">2,00</span></span>
                    </div>
                    
                    <button type="submit" id="btnSubmit" class="btn-pay">
                        FINALIZAR E PAGAR AGORA
                    </button>
                    
                    <p class="text-center text-xs text-slate-400 mt-4 flex items-center justify-center gap-1">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"></path></svg>
                        Ambiente Seguro ‚Ä¢ Mercado Pago
                    </p>
                </div>
            </form>
        </main>

        <footer class="text-center text-slate-400 text-xs">
            ¬© 2026 Barraca do Ari - Todos os direitos reservados.
        </footer>
    </div>

    <script>
<script>
    // --- CONFIGURA√á√ÉO INICIAL ---
    let quantidade = 1;
    const precoUnitario = 2.00;
    
    // Esta √© a URL da "ponte" que criamos. 
    // Ela recebe os dados do seu site e fala com o Mercado Pago usando seu Token Secreto.
    const functionUrl = 'https://eisruaetsqrratemqswv.functions.supabase.co/checkout';

    // --- L√ìGICA DE INTERFACE ---
    function mudarQtd(valor) {
        // Impede que a quantidade seja menor que 1
        quantidade = Math.max(1, quantidade + valor);
        document.getElementById('qtdDisplay').innerText = quantidade;
        
        // Atualiza o valor visual na tela (Qtd x 2.00)
        document.getElementById('totalDisplay').innerText = (quantidade * precoUnitario).toFixed(2);
    }

    // --- ENVIO DO PAGAMENTO ---
    document.getElementById('payForm').onsubmit = async (e) => {
        e.preventDefault(); // Impede a p√°gina de recarregar
        
        const btn = document.getElementById('btnSubmit');
        const nome = document.getElementById('cliente_nome').value;
        const email = document.getElementById('cliente_email').value;
        const total = (quantidade * precoUnitario).toFixed(2);

        // 1. ESTADO DE CARREGAMENTO (Feedback para o usu√°rio n√£o clicar duas vezes)
        btn.disabled = true;
        btn.innerHTML = `<span class="loading-spinner"></span> PROCESSANDO...`;

        try {
            // 2. CHAMADA PARA A EDGE FUNCTION
            // Enviamos os dados do formul√°rio para o Supabase
            const response = await fetch(functionUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    nome: nome,
                    email: email,
                    total: parseFloat(total), // Valor calculado
                    itens: [{
                        id: 'pdf-001',
                        nome: 'E-book Cria√ß√£o de PDF',
                        qtd: quantidade,
                        preco: precoUnitario
                    }]
                })
            });

            // 3. RESPOSTA DO MERCADO PAGO
            // O Supabase responde com um JSON contendo o link do Mercado Pago (init_point)
            const data = await response.json();

            if (data.init_point) {
                // REDIRECIONAMENTO: Abre a tela de pagamento (Pix/Cart√£o)
                window.location.href = data.init_point;
            } else {
                throw new Error('Link de pagamento n√£o gerado');
            }

        } catch (error) {
            // 4. TRATAMENTO DE ERRO
            console.error('Erro no checkout:', error);
            alert('Erro ao iniciar pagamento. Verifique sua conex√£o ou tente novamente.');
            
            // Reset do bot√£o para o usu√°rio tentar de novo
            btn.disabled = false;
            btn.innerHTML = `TENTAR NOVAMENTE`;
        }
    };
</script>
    </script>
</body>
</html>
```


# O que este arquivo faz:
* C√°lculo Autom√°tico: O cliente aumenta ou diminui a quantidade e o valor total (R$ 2,00 x Qtd) atualiza na hora na tela.
* Valida√ß√£o: Impede que o cliente pe√ßa menos de 1 unidade e exige nome/e-mail/telefone.
* Estado de Loading: O bot√£o muda para "Processando..." com um √≠cone de carregamento para o cliente saber que algo est√° acontecendo.
* Integra√ß√£o Direta: Ele envia o nome do cliente e o valor total direto para a sua fun√ß√£o do Supabase.

# Como estamos usando Edge Functions, a seguran√ßa funciona de um jeito diferente (e muito mais seguro) do que em um site comum.
Aqui est√° a explica√ß√£o de onde cada pe√ßa do quebra-cabe√ßa se encaixa.
## Onde ficam as chaves?
* Chaves do Mercado Pago (AccessToken): Elas N√ÉO ficam no c√≥digo HTML. Elas j√° est√£o seguras dentro do servidor do Supabase porque voc√™ rodou o comando supabase secrets set no terminal anteriormente. A fun√ß√£o que est√° na nuvem l√™ essa chave internamente.
* Chave do Supabase (Anon Key): Para este m√©todo que criamos (chamada direta via fetch), voc√™ n√£o precisa colocar a chave no HTML, pois a sua fun√ß√£o est√° configurada como p√∫blica ou verificada pelo dom√≠nio.
* A URL da Fun√ß√£o: Esta √© a √∫nica "chave" que fica no HTML. √â o endere√ßo que diz ao navegador para onde enviar os dados do cliente.


Resumo de Onde Est√° Cada Coisa:
____________________________________________________________________________________________

| Item	                  | Onde est√° guardado?	    | Seguran√ßa                            |
-------------------------------------------------------------------------------------------|
| Token do Mercado Pago	  | No Supabase (Secrets)	| M√°xima (Ningu√©m v√™ no c√≥digo)        |
| L√≥gica de Pre√ßo	      | No seu index.html	    | Vis√≠vel (Mas validado pela fun√ß√£o)   |
| URL da Fun√ß√£o	          | No seu index.html	    | P√∫blica (√â o seu endpoint)           |
| Dados do Cliente	      | No formul√°rio HTML	    | Tempor√°rio (Enviado via POST seguro) |
____________________________________________________________________________________________


# üß± Criar o projeto no Supabase
## Criar conta e projeto
* Acesse: https://supabase.com
* Crie uma conta
* Clique em New Project
## Escolha:
* Nome do projeto
* Senha do banco
* Regi√£o

# ONDE FICAM AS CONFIGURA√á√ïES DO SUPABASE?
## V√° em Altentications
Url config/ escreva o seu dominio **CONFIGURAR A URL DO SEU SITE**
## V√° em Settings:
*  DATA API/Project URL/copie a **URL SUPABASE**
*  API Keis/anon public key/copiar **ANON KEY**


üìë Relat√≥rio de Documenta√ß√£o e Backup (Projeto: Barraca do Ari)
1. Vis√£o Geral da Arquitetura

O sistema utiliza uma arquitetura moderna e sem custos fixos:

    Frontend: GitHub Pages (Hospedagem gratuita do HTML/JS).

    Backend: Supabase Edge Functions (Executa o c√≥digo de integra√ß√£o de forma segura).

    Pagamento: Mercado Pago API (Processamento de Pix e Cart√£o).

    Seguran√ßa: Chaves sens√≠veis armazenadas como Secrets no Supabase (n√£o vis√≠veis no navegador).

2. Credenciais e Identificadores (Chaves Verdadeiras)

    Importante: Mantenha estas informa√ß√µes em local seguro.

    Nome do Projeto: aristidesbp.github.io

    ID do Projeto Supabase: eisruaetsqrratemqswv

    URL da Fun√ß√£o de Checkout: https://eisruaetsqrratemqswv.functions.supabase.co/checkout

    Token do Mercado Pago: Configurado via CLI no Supabase sob o nome MP_ACCESS_TOKEN.

    Reposit√≥rio Git: git@github.com:aristidesbp/aristidesbp.github.io.git (Acesso via SSH).

3. C√≥digos de Backup
A. Frontend (index.html)

Este arquivo cont√©m a interface da "Barraca do Ari", c√°lculo de quantidade e a chamada para o pagamento.
B. Backend (supabase/functions/checkout/index.ts)

Este √© o c√©rebro que gera o link do Mercado Pago. Configura√ß√£o crucial:
```
// Headers para evitar erro de CORS
const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
}

// Resposta bem-sucedida deve retornar o init_point do Mercado Pago
return new Response(JSON.stringify({ init_point: preference.body.init_point }), {
  headers: { ...corsHeaders, 'Content-Type': 'application/json' },
  status: 200,
});


```

4. Tutorial de Manuten√ß√£o (Como atualizar)

    Para atualizar o site:

        Edite o index.html.

        No terminal: git add . -> git commit -m "update" -> git push origin main.

    Para atualizar a l√≥gica de pagamento:

        Edite o arquivo .ts dentro da pasta supabase.

        No terminal: supabase functions deploy checkout --no-verify-jwt.

‚úÖ Checklist do que falta para finalizar

Embora o checkout abra, faltam os detalhes de "p√≥s-venda" para o neg√≥cio ser lucrativo e autom√°tico:

    [ ] P√°gina de Sucesso/Retorno: Criar um arquivo sucesso.html. Configurar no Mercado Pago para que, ap√≥s o Pix pago, o cliente volte para esta p√°gina.

    [ ] Entrega Autom√°tica do PDF: Atualmente, voc√™ recebe o dinheiro, mas precisa enviar o PDF manualmente. Falta configurar um Webhook ou uma integra√ß√£o de e-mail (como SendGrid) para disparar o arquivo assim que o pagamento for aprovado.

    [ ] Valida√ß√£o de Telefone: Adicionar uma m√°scara no formul√°rio para garantir que o WhatsApp seja digitado no formato correto (Ex: 91999999999).

    [ ] Banco de Dados de Pedidos: Configurar a tabela no Supabase para salvar o nome e e-mail de quem comprou, criando sua lista de clientes para marketing futuro.




# supabase/functions/checkout/index.ts
```
import { serve } from "https://deno.land/std@0.168.0/http/server.ts"

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Methods': 'POST',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
}

serve(async (req) => {
  // Lida com a requisi√ß√£o de seguran√ßa (CORS)
  if (req.method === 'OPTIONS') {
    return new Response('ok', { headers: corsHeaders })
  }

  try {
    const { nome, total, itens } = await req.json()

    // Cria a prefer√™ncia de pagamento no Mercado Pago
    const response = await fetch("https://api.mercadopago.com/checkout/preferences", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${Deno.env.get('MP_ACCESS_TOKEN')}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        items: [
          {
            title: `Pedido Tapioca da Maria - ${nome}`,
            unit_price: total,
            quantity: 1,
            currency_id: "BRL",
          }
        ],
        // Onde o cliente cai ap√≥s pagar
        back_urls: {
          success: "https://aristidesbp.github.io/",
        },
        auto_return: "approved",
      }),
    })

    const data = await response.json()

    return new Response(JSON.stringify({ init_point: data.init_point }), {
      headers: { ...corsHeaders, "Content-Type": "application/json" },
      status: 200,
    })

  } catch (error) {
    return new Response(JSON.stringify({ error: error.message }), {
      headers: { ...corsHeaders, "Content-Type": "application/json" },
      status: 400,
    })
  }
})
```














``
