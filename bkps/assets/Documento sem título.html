<!-- üì¶ FORMUL√ÅRIO COMPLETO COM SALVAMENTO, TABELA, EDI√á√ÉO, EXCLUS√ÉO E BACKUP -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agendamento de Consultoria</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    textarea, input, select { display: block; width: 100%; margin: 10px 0; padding: 10px; }
    button { padding: 10px 20px; margin: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    th { background-color: #f0f0f0; }
  </style>
</head>
<body>
<textarea id="texto"></textarea>
<button onclick="converter()">Converter em JSON e baixar</button>

<script>
function converter() {
  const texto = document.getElementById("texto").value;
  const linhas = texto.split('\n');
  const dados = {};

  // Transforma cada linha no formato CHAVE: VALOR
  linhas.forEach(linha => {
    const [chave, valor] = linha.split(':');
    if (chave && valor) {
      dados[chave.trim().toUpperCase()] = valor.trim();
    }
  });

  // Extrai o n√∫mero do campo TOTAL (ex: R$300.00 => 300.00)
  const totalNumerico = dados["TOTAL"] 
    ? parseFloat(dados["TOTAL"].replace(/[^\d,.-]+/g, '').replace(',', '.')) 
    : 0;

  const obj = {
    nome: dados["NOME"] || "",
    cpf: (dados["CPF"] || "").replace(/\D/g, ""),
    telefone: dados["TELEFONE"] || "",
    data: dados["DATA"] || "",
    hora: (dados["HORA"] || "").substring(0, 5),
    servicos: dados["SERVICOS"] 
      ? dados["SERVICOS"].split(',').map(s => s.trim()) 
      : [],
    total: totalNumerico
  };

  const jsonArray = [obj];

  const jsonString = JSON.stringify(jsonArray, null, 2);
  alert(jsonString);
  baixarArquivo(jsonString, 'agendamento-formatado.json');
}

function baixarArquivo(conteudo, nomeArquivo) {
  const blob = new Blob([conteudo], { type: "application/json" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = nomeArquivo;
  link.click();
}
</script>



  <h1>Agendar Consultoria</h1>
  <textarea id="json"></textarea>
  <button onclick="salvarJSON()">Salvar</button>
  <button onclick="baixarBackup()">Baixar Backup</button>
  <input type="file" accept=".json" onchange="importarJSON(event)">

  <table id="tabela">
    <thead>
      <tr>
        <th>Nome</th>
        <th>CPF</th>
        <th>Data</th>
        <th>Servi√ßos</th>
        <th>Total</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
let agendamentos = JSON.parse(localStorage.getItem('agendamentos')) || [];

function salvarJSON() {
  try {
    const dados = JSON.parse(document.getElementById("json").value);
    dados.id = Date.now();
    dados.total = calcularTotal(dados.servicos);
    agendamentos.push(dados);
    atualizarLocalStorage();
    renderTabela();
    document.getElementById("json").value = "";
  } catch (e) {
    alert("JSON inv√°lido");
  }
}

function calcularTotal(servicos) {
  const precos = {
    "tr√°fego pago": 100,
    "tr√°fego org√¢nico": 100,
    "redes sociais": 100,
    "cria√ß√£o de site": 100
  };
  return servicos.reduce((soma, srv) => soma + (precos[srv] || 0), 0);
}

function atualizarLocalStorage() {
  localStorage.setItem("agendamentos", JSON.stringify(agendamentos));
}

function renderTabela() {
  const corpo = document.querySelector("#tabela tbody");
  corpo.innerHTML = "";
  agendamentos.sort((a, b) => new Date(a.data) - new Date(b.data));
  agendamentos.forEach((item, i) => {
    const linha = document.createElement("tr");
    linha.innerHTML = `
      <td>${item.nome}</td>
      <td>${item.cpf}</td>
      <td>${item.data}</td>
      <td>${item.servicos.join(", ")}</td>
      <td>R$ ${item.total}</td>
      <td>
        <button onclick="editar(${item.id})">‚úèÔ∏è</button>
        <button onclick="excluir(${item.id})">üóëÔ∏è</button>
      </td>
    `;
    corpo.appendChild(linha);
  });
}

function excluir(id) {
  agendamentos = agendamentos.filter(item => item.id !== id);
  atualizarLocalStorage();
  renderTabela();
}

function editar(id) {
  const item = agendamentos.find(i => i.id === id);
  document.getElementById("json").value = JSON.stringify(item, null, 2);
  excluir(id);
}

function baixarBackup() {
  const blob = new Blob([JSON.stringify(agendamentos, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'agendamentos.json';
  a.click();
}

function importarJSON(event) {
  const file = event.target.files[0];
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const dados = JSON.parse(reader.result);
      agendamentos = dados;
      atualizarLocalStorage();
      renderTabela();
    } catch (e) {
      alert("Arquivo inv√°lido");
    }
  };
  reader.readAsText(file);
}

// Inicializa
renderTabela();
</script>
</body>
</html>

