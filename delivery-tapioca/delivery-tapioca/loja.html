<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Lista de Produtos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">

  <h1 class="mb-4">Lista de Produtos</h1>

  <div class="mb-3">
    <label for="importarArquivo" class="form-label">Importar JSON:</label>
    <input type="file" id="importarArquivo" accept=".json" class="form-control w-auto" onchange="importarDados(event)">
  </div>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Produto</th>
        <th>Preço</th>
      </tr>
    </thead>
    <tbody id="listaProdutos"></tbody>
  </table>

  <script>
    let produtos = [];

    function salvarProdutos() {
      localStorage.setItem("produtos", JSON.stringify(produtos));
      renderizarProdutos();
    }

    function renderizarProdutos() {
      const tbody = document.getElementById("listaProdutos");
      tbody.innerHTML = "";
      produtos.forEach(p => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${p.nome}</td><td>R$ ${p.preco.toFixed(2)}</td>`;
        tbody.appendChild(tr);
      });
    }

    function importarDados(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const dados = JSON.parse(e.target.result);
          if (Array.isArray(dados)) {
            produtos = dados;
            salvarProdutos();
          } else {
            alert("Formato de arquivo inválido.");
          }
        } catch (err) {
          alert("Erro ao ler o arquivo JSON.");
        }
      };
      reader.readAsText(file);
    }

    function importarArquivoPadrao() {
      // Só importa se não tiver produtos salvos no localStorage
      if (localStorage.getItem("produtos")) {
        produtos = JSON.parse(localStorage.getItem("produtos"));
        renderizarProdutos();
        return;
      }

      fetch("assets/produtos.json")
        .then(response => {
          if (!response.ok) throw new Error("Erro ao carregar o arquivo padrão.");
          return response.json();
        })
        .then(data => {
          if (Array.isArray(data)) {
            produtos = data;
            salvarProdutos();
          } else {
            alert("Arquivo JSON padrão inválido.");
          }
        })
        .catch(err => {
          console.error(err);
          alert("Erro ao importar arquivo padrão.");
        });
    }

    window.addEventListener("load", importarArquivoPadrao);
  </script>
</body>
</html>

