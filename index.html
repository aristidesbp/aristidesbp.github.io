<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Login</title>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 400px;
  margin: 60px auto;
}

input, button {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
}

.senha {
  position: relative;
}

.senha span {
  position: absolute;
  right: 10px;
  top: 12px;
  cursor: pointer;
}

a {
  cursor: pointer;
  color: blue;
  text-decoration: underline;
}
</style>
</head>
<body>

<h2 id="titulo">Login</h2>

<input id="email" type="email" placeholder="Email" required>

<div class="senha">
  <input id="senha" type="password" placeholder="Senha" required>
  <span onclick="toggleSenha()">üëÅÔ∏è</span>
</div>

<button id="btnAcao" onclick="login()">Entrar</button>

<p>
  <a onclick="mostrarCadastro()">Criar conta</a> |
  <a onclick="resetSenha()">Esqueci minha senha</a>
</p>

<!-- Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* ================================
   CONFIGURA√á√ÉO
================================ */
const dbsupabase = supabase.createClient(
  'https://SEU-PROJETO.supabase.co',
  'SUA-ANON-KEY'
)

/* ================================
   FUN√á√ïES DE UI
================================ */
function toggleSenha() {
  const input = document.getElementById('senha')
  input.type = input.type === 'password' ? 'text' : 'password'
}

/* ================================
   LOGIN
================================ */
async function login() {
  const email = document.getElementById('email').value
  const senha = document.getElementById('senha').value

  const { error } = await dbsupabase.auth.signInWithPassword({
    email: email,
    password: senha
  })

  if (error) {
    alert(error.message)
    return
  }

  window.location.href = 'dashboard.html'
}

/* ================================
   RESET DE SENHA
================================ */
async function resetSenha() {
  const email = document.getElementById('email').value

  if (!email) {
    alert('Digite seu email')
    return
  }

  const { error } = await dbsupabase.auth.resetPasswordForEmail(email, {
    redirectTo: window.location.origin
  })

  if (error) {
    alert(error.message)
    return
  }

  alert('Email de recupera√ß√£o enviado!')
}

/* ================================
   TELA DE CADASTRO
================================ */
function mostrarCadastro() {
  document.getElementById('titulo').innerText = 'Cadastro'
  const btn = document.getElementById('btnAcao')
  btn.innerText = 'Cadastrar'
  btn.onclick = cadastrar
}

/* ================================
   CADASTRO SEGURO
================================ */
async function cadastrar() {
  const email = document.getElementById('email').value
  const senha = document.getElementById('senha').value

  const { data, error } = await dbsupabase.auth.signUp({
    email: email,
    password: senha
  })

  if (error) {
    alert(error.message)
    return
  }

  // cria v√≠nculo seguro no banco
  await dbsupabase.from('usuarios').insert({
    email: email,
    nome: email.split('@')[0],
    auth_id: data.user.id
  })

  alert('Cadastro realizado! Verifique seu email.')
}
</script>

</body>
</html>
