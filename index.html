<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barraca do Ari - Soluções Digitais</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading-skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton 1.5s infinite; }
        @keyframes skeleton { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="navbar-container"></div>

    <header class="bg-blue-600 text-white py-12 text-center shadow-lg">
        <h1 class="text-4xl font-bold">Barraca do Ari</h1>
        <p class="mt-2 text-blue-100">Transformando seu negócio com tecnologia e estratégia</p>
    </header>

    <main class="container mx-auto px-4 py-8">
        
        <div class="flex flex-col md:flex-row gap-4 mb-8 justify-between">
            <input type="text" id="busca-item" placeholder="Buscar tutorial ou serviço..." class="p-2 border rounded-lg w-full md:w-1/2 shadow-sm">
            <select id="filtro-categoria" class="p-2 border rounded-lg shadow-sm">
                <option value="todos">Todas as Categorias</option>
                <option value="pdf">Tutoriais PDF</option>
                <option value="servicos">Serviços</option>
            </select>
        </div>

        <div id="lista-produtos" class="grid grid-cols-1 md:grid-cols-3 gap-6">
            </div>

        <div id="carrinho" class="fixed bottom-4 right-4 bg-white p-6 rounded-2xl shadow-2xl border border-gray-200 hidden w-80">
            <h3 class="text-xl font-bold mb-4">Seu Pedido</h3>
            <div id="itens-carrinho" class="max-h-60 overflow-y-auto mb-4"></div>
            <div class="border-t pt-4">
                <p class="flex justify-between font-bold text-lg"><span>Total:</span> <span id="total-valor">R$ 0,00</span></p>
                <button onclick="finalizarCompra()" id="btn-checkout" class="w-full bg-green-600 text-white py-3 rounded-xl mt-4 font-bold hover:bg-green-700 transition">
                    Pagar com Mercado Pago
                </button>
            </div>
        </div>
    </main>

    <script>
        // Dados que devem estar em produtos.json e servicos.json (Conforme sua regra)
        const db = {
            produtos: [
                { id: 1, nome: "Como iniciar um negócio lucrativo com zero reais", preco: 47.00, categoria: "pdf", img: "https://placehold.co/400x300?text=Negócio+Zero" },
                { id: 2, nome: "Sistema completo sem custos mensais", preco: 97.00, categoria: "pdf", img: "https://placehold.co/400x300?text=Sistema+Grátis" },
                { id: 3, nome: "Como não perder dinheiro com tráfego pago", preco: 67.00, categoria: "pdf", img: "https://placehold.co/400x300?text=Tráfego+Pago" }
            ],
            servicos: [
                { id: 4, nome: "Desenvolvimento de Sistemas e Sites", preco: 1500.00, categoria: "servicos", img: "https://placehold.co/400x300?text=Dev+Sistemas" },
                { id: 5, nome: "Criação de Tráfego Pago", preco: 800.00, categoria: "servicos", img: "https://placehold.co/400x300?text=Ads+Expert" },
                { id: 6, nome: "Consultoria Estratégica", preco: 300.00, categoria: "servicos", img: "https://placehold.co/400x300?text=Consultoria" }
            ]
        };

        let carrinho = [];

        function renderizar() {
            const container = document.getElementById('lista-produtos');
            const todosItens = [...db.produtos, ...db.servicos];
            
            container.innerHTML = todosItens.map(item => `
                <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition p-4 border border-gray-100">
                    <img src="${item.img}" class="w-full h-40 object-cover rounded-lg mb-4">
                    <h3 class="font-bold text-lg h-14">${item.nome}</h3>
                    <p class="text-blue-600 font-bold text-xl mt-2">R$ ${item.preco.toFixed(2)}</p>
                    <button id="btn-${item.id}" onclick="adicionar(${item.id})" class="w-full mt-4 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">Adicionar</button>
                </div>
            `).join('');
        }

        function adicionar(id) {
            const item = [...db.produtos, ...db.servicos].find(i => i.id === id);
            carrinho.push(item);
            atualizarCarrinho();
        }

        function atualizarCarrinho() {
            const divItens = document.getElementById('itens-carrinho');
            const divCarrinho = document.getElementById('carrinho');
            const totalTxt = document.getElementById('total-valor');
            
            if(carrinho.length > 0) divCarrinho.classList.remove('hidden');
            
            divItens.innerHTML = carrinho.map(i => `<p class="flex justify-between text-sm mb-2"><span>${i.nome}</span> <b>R$ ${i.preco}</b></p>`).join('');
            const total = carrinho.reduce((acc, i) => acc + i.preco, 0);
            totalTxt.innerText = `R$ ${total.toFixed(2)}`;
        }

        async function finalizarCompra() {
            const btn = document.getElementById('btn-checkout');
            btn.innerText = "Processando...";
            btn.disabled = true;

            const total = carrinho.reduce((acc, i) => acc + i.preco, 0);

            try {
                // INTEGRACÃO COM SUA EDGE FUNCTION
                const response = await fetch('https://eisruaetsqrratemqswv.functions.supabase.co/checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        nome: "Cliente Barraca do Ari",
                        total: total,
                        itens: carrinho.map(i => i.nome).join(', ')
                    })
                });

                const result = await response.json();
                if (result.init_point) {
                    window.location.href = result.init_point;
                } else {
                    alert("Erro ao gerar pagamento. Verifique os logs do Supabase.");
                }
            } catch (err) {
                console.error(err);
                alert("Falha na conexão com o servidor.");
            } finally {
                btn.innerText = "Pagar com Mercado Pago";
                btn.disabled = false;
            }
        }

        renderizar();
    </script>
</body>
</html>
