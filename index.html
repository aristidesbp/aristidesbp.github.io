<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Login</title>
<style>
body {
  font-family: Arial;
  max-width: 400px;
  margin: 60px auto;
}
input, button {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
}
.senha {
  position: relative;
}
.senha span {
  position: absolute;
  right: 10px;
  top: 12px;
  cursor: pointer;
}
a {
  cursor: pointer;
  color: blue;
}
</style>
</head>
<body>

<h2 id="titulo">Login</h2>

<input id="email" type="email" placeholder="Email">

<div class="senha">
  <input id="senha" type="password" placeholder="Senha">
  <span onclick="toggleSenha()">üëÅÔ∏è</span>
</div>

<button onclick="login()">Entrar</button>

<p>
  <a onclick="mostrarCadastro()">Criar conta</a> |
  <a onclick="resetSenha()">Esqueci minha senha</a>
</p>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabase = supabase.createClient(
  'https://SEU-PROJETO.supabase.co',
  'SUA-ANON-KEY'
)

function toggleSenha() {
  const input = document.getElementById('senha')
  input.type = input.type === 'password' ? 'text' : 'password'
}

async function login() {
  const email = email.value
  const password = senha.value

  const { error } = await supabase.auth.signInWithPassword({
    email, password
  })

  if (error) return alert(error.message)

  window.location.href = 'dashboard.html'
}

async function resetSenha() {
  const emailValue = email.value
  if (!emailValue) return alert('Digite seu email')

  await supabase.auth.resetPasswordForEmail(emailValue, {
    redirectTo: window.location.origin
  })

  alert('Email de recupera√ß√£o enviado!')
}

function mostrarCadastro() {
  document.getElementById('titulo').innerText = 'Cadastro'
  document.querySelector('button').innerText = 'Cadastrar'
  document.querySelector('button').onclick = cadastrar
}

async function cadastrar() {
  const emailValue = email.value
  const password = senha.value

  const { data, error } = await supabase.auth.signUp({
    email: emailValue,
    password
  })

  if (error) return alert(error.message)

  // cria registro seguro na tabela usuarios
  await supabase.from('usuarios').insert({
    email: emailValue,
    nome: emailValue.split('@')[0],
    auth_id: data.user.id
  })

  alert('Cadastro realizado! Verifique seu email.')
}
</script>

</body>
</html>
